1. # Juris-RAG 实验报告

   ## 项目概述

   - 面向中文法律咨询的检索增强生成（RAG）系统，覆盖刑法、民法、商法、行政法、劳动法五个领域。
   - 目标：提供可追溯、低幻觉的法律问答，支持多轮对话、引用展示和超范围拒答。
   - 当前状态：数据处理、向量库构建、RAG 引擎、Gradio Web UI 与评估脚本均可运行。

   ## 数据来源与处理

   - 法条：五大领域官方条文文本（2020 修订版及相关法律）。
   - 案例：CAIL2018 `cail_cases.json`（默认 100K，可通过 `CAIL_CASE_LIMIT` 抽样）。
   - 处理流程（`src/data_processing.py`）：
     - 清洗与分条：按条款/章节拆分，过滤控制字符。
     - 分块：`chunk_size=800`，`chunk_overlap=150`，保持法条语义完整。
     - 向量化：BGE-M3（SiliconFlow API），写入 `data/vector_db/<domain>` 独立持久化库。
     - 节流：RPM/TPM 限制、批处理、重试与指数回退，避免 429。

   ## 方法

   - 查询理解：保留 15 轮历史，进行问题改写以强化追问场景。
   - 混合检索：罪名关键词扩展 + 法条/案例双通道检索，法条权重 1.5x。
   - 超范围判别：领域关键词 + 检索相关性阈值双判定，返回拒答模板。
   - 生成：Qwen3-8B（128K）低温度生成，输出回答、引用、置信度。
   - 前端：Gradio ChatGPT 风格界面，支持模式切换（问答/文档搜索/系统信息）。

   ## 实验结果（表格 + 曲线）

   - 评估脚本：`python eval.py`，内置 23 条问答（刑法/边界/超范围混合）。
   - 核心指标：

   | 指标     | 数值   | 说明                       |
   | -------- | ------ | -------------------------- |
   | 准确率   | 65.22% | 15/23 样本正确             |
   | 引用 F1  | 86.75% | 引用质量综合指标           |
   | 幻觉率   | 21.74% | 主要来自少见罪名与边界场景 |
   | 平均响应 | 9.15s  | 2048 tokens 生成配置       |

   - 趋势曲线（ASCII）：

   ```
   准确率: v1.0 0.90 ██████████
           v2.0 0.65 ██████
   幻觉率: v1.0 0.10 ██
           v2.0 0.22 ████
   ```

   ## 问题分析与创新点

   - 主要问题：
     - 少见罪名（走私、强奸等）覆盖不足，导致幻觉或答非所问。
     - 超范围拒答仍有漏判，需要更强的安全网（重排或判别器）。
     - 向量化/生成存在尾部延迟，需缓存或并行优化。
   - 创新点：
     - 五领域独立向量库 + 法条优先权重，便于按域扩展与调优。
     - 罪名关键词映射的多查询增强，提升法条命中率。
     - 关键词 + 相关性双重超范围判别，配合置信度标注。
     - API 节流与退避策略，适配 SiliconFlow 配额，提升稳定性。
     - Gradio 6 兼容的消息/主题处理，UI 支持引用侧栏与模式切换。

   ## Demo 截图/链接

   - 运行 `python app.py` 后访问 `http://127.0.0.1:7860`（本地 Demo）。
   - 界面：ChatGPT 风格对话区 + 引用侧栏 + 模式切换（智能问答/文档搜索/系统信息）。
   - 截图占位：可在运行后于浏览器保存当前界面。

   ## 未来改进方向

   - 引入 reranker/判别器加强超范围拒答与排序质量。
   - 扩展知识产权、税法等新领域；支持在线增量更新与版本管理。
   - 缓存/并行化优化向量化与生成，降低长尾延迟。
   - 建立评估流水线（CI），引入可视化趋势看板。
   - 支持用户上传文档并即时索引；增加检索/引用可视化。
